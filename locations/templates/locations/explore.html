<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore Retirement Locations - VetRetire</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f9fafb;
            color: #333;
        }

        .navbar {
            background: white;
            padding: 1rem 5%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2563eb;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: #4b5563;
            font-weight: 500;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 5%;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }

        .sidebar {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            height: fit-content;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            position: sticky;
            top: 100px;
        }

        .sidebar h2 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: #1f2937;
        }

        .filter-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .filter-section:last-child {
            border-bottom: none;
        }

        .filter-section h3 {
            font-size: 0.95rem;
            margin-bottom: 1rem;
            color: #374151;
            font-weight: 600;
        }

        .filter-option {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .filter-option input[type="checkbox"],
        .filter-option input[type="radio"] {
            margin-right: 0.5rem;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .filter-option label {
            font-size: 0.9rem;
            color: #4b5563;
            cursor: pointer;
        }

        select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .price-range {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .price-range input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .apply-filters {
            width: 100%;
            background: #2563eb;
            color: white;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .apply-filters:hover {
            background: #1d4ed8;
        }

        .main-content {
            min-height: 100vh;
        }

        .results-header {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .results-info {
            font-size: 1.1rem;
            color: #374151;
        }

        .results-info strong {
            color: #2563eb;
        }

        .view-toggle {
            display: flex;
            gap: 0.5rem;
        }

        .view-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .view-btn.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .sort-options {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .sort-options select {
            margin: 0;
            width: auto;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .location-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .location-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .card-image {
            width: 100%;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            position: relative;
        }

        .card-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.95);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: #2563eb;
        }

        .card-content {
            padding: 1.5rem;
        }

        .location-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .location-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1f2937;
        }

        .location-state {
            font-size: 0.9rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        .match-score {
            background: #10b981;
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .card-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat {
            display: flex;
            flex-direction: column;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
        }

        .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .tag {
            background: #eff6ff;
            color: #2563eb;
            padding: 0.3rem 0.7rem;
            border-radius: 6px;
            font-size: 0.8rem;
        }

        .card-footer {
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .va-distance {
            font-size: 0.85rem;
            color: #6b7280;
        }

        .learn-more {
            color: #2563eb;
            font-weight: 600;
            font-size: 0.9rem;
            text-decoration: none;
        }

        .pillbox-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .pillbox {
            padding: 0.5rem 1rem;
            border: 2px solid #d1d5db;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            color: #4b5563;
            transition: all 0.2s ease;
            user-select: none;
        }

        .pillbox:hover {
            border-color: #2563eb;
            background: #eff6ff;
            color: #2563eb;
        }

        .pillbox.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">VetRetire</div>
            <ul class="nav-links">
                <li><a href="{% url 'locations:home' %}">Home</a></li>
                <li><a href="{% url 'locations:explore' %}" style="color: #2563eb;">Explore</a></li>
                <li><a href="#">Saved</a></li>
                <li><a href="#">Profile</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <aside class="sidebar">
            <h2>Filters</h2>

            <div class="filter-section">
                <h3>Climate</h3>
                <div class="filter-option">
                    <input type="checkbox" id="warm" checked>
                    <label for="warm">Warm & Sunny</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="mild">
                    <label for="mild">Mild & Temperate</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="cool">
                    <label for="cool">Cool & Dry</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="four-season">
                    <label for="four-season">Four Seasons</label>
                </div>
                
                <h3 style="margin-top: 1.5rem;">Snow</h3>
                <div class="pillbox-container">
                    <div class="pillbox" data-snow="zero">Zero Snow</div>
                    <div class="pillbox" data-snow="some">Some Snow</div>
                    <div class="pillbox" data-snow="lots">Lots of Snow</div>
                </div>

                <h3 style="margin-top: 1.5rem;">Gun Laws</h3>
                <div class="pillbox-container">
                    <div class="pillbox" data-gun-laws="relaxed">Relaxed Gun Laws</div>
                    <div class="pillbox" data-gun-laws="some">Some Gun Laws</div>
                    <div class="pillbox" data-gun-laws="strict">Strict Gun Laws</div>
                </div>

                <h3 style="margin-top: 1.5rem;">Misc</h3>
                <div class="filter-option">
                    <input type="checkbox" id="lgbtq-friendly">
                    <label for="lgbtq-friendly">LGBTQ Friendly</label>
                </div>
            </div>

            <div class="filter-section">
                <h3>Cost of Living</h3>
                <select>
                    <option>Any Budget</option>
                    <option>Low ($)</option>
                    <option selected>Moderate ($$)</option>
                    <option>High ($$$)</option>
                </select>
                <div class="price-range">
                    <input type="text" placeholder="Min $" value="$50k">
                    <span>-</span>
                    <input type="text" placeholder="Max $" value="$150k">
                </div>
            </div>

            <div class="filter-section">
                <h3>Lifestyle</h3>
                <div class="filter-option">
                    <input type="checkbox" id="urban" checked>
                    <label for="urban">Urban</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="suburban" checked>
                    <label for="suburban">Suburban</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="rural">
                    <label for="rural">Rural</label>
                </div>
            </div>

            <div class="filter-section">
                <h3>Healthcare Access</h3>
                <div class="filter-option">
                    <input type="checkbox" id="va-hospital" checked>
                    <label for="va-hospital">VA Hospital Nearby</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="va-clinic">
                    <label for="va-clinic">VA Clinic Access</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="quality-care">
                    <label for="quality-care">Top-Rated Healthcare</label>
                </div>
            </div>

            <div class="filter-section">
                <h3>Activities</h3>
                <div class="filter-option">
                    <input type="checkbox" id="golf">
                    <label for="golf">Golf</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="fishing" checked>
                    <label for="fishing">Fishing</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="hiking">
                    <label for="hiking">Hiking</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="culture">
                    <label for="culture">Arts & Culture</label>
                </div>
            </div>

            <button class="apply-filters">Apply Filters</button>
        </aside>

        <main class="main-content">
            <div class="results-header">
                <div>
                    <div class="results-info">
                        Found <strong>{{ total_results }} locations</strong> matching your criteria
                    </div>
                </div>
                <div class="sort-options">
                    <label>Sort by:</label>
                    <select id="sort-select">
                        <option value="best">Best Match</option>
                        <option value="cost_asc">Cost (Low to High)</option>
                        <option value="cost_desc">Cost (High to Low)</option>
                        <option value="climate">Climate</option>
                        <option value="va">VA Access</option>
                        <option value="gas_asc">Gas Price (Low to High)</option>
                        <option value="gas_desc">Gas Price (High to Low)</option>
                    </select>
                    <div class="view-toggle">
                        <button class="view-btn active">Grid</button>
                        <button class="view-btn">Map</button>
                    </div>
                </div>
            </div>

            <div class="results-grid" id="results-grid">
                {% include 'locations/partials/location_cards.html' %}
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const pillboxes = document.querySelectorAll('.pillbox');
            const sortSelect = document.getElementById('sort-select');
            const lgbtqCheckbox = document.getElementById('lgbtq-friendly');

            function getActiveSnow() {
                const active = document.querySelector('.pillbox[data-snow].active');
                return active ? active.getAttribute('data-snow') : null;
            }

            function getActiveGunLaws() {
                const active = document.querySelector('.pillbox[data-gun-laws].active');
                return active ? active.getAttribute('data-gun-laws') : null;
            }

            function getLgbtqFriendly() {
                return lgbtqCheckbox && lgbtqCheckbox.checked;
            }

            function refreshResults() {
                const snowValue = getActiveSnow();
                const gunLawsValue = getActiveGunLaws();
                const lgbtqValue = getLgbtqFriendly();
                const sortValue = sortSelect ? sortSelect.value : 'best';
                const params = new URLSearchParams();
                if (snowValue) params.append('snow', snowValue);
                if (gunLawsValue) params.append('gun_laws', gunLawsValue);
                if (lgbtqValue) params.append('lgbtq_friendly', 'true');
                if (sortValue) params.append('sort', sortValue);
                htmx.ajax('GET', "{% url 'locations:filter_locations' %}" + (params.toString() ? ('?' + params.toString()) : ''), {
                    target: '#results-grid',
                    swap: 'innerHTML'
                });
            }

            // Handle pillbox clicks (include current sort and all filters)
            pillboxes.forEach(pillbox => {
                pillbox.addEventListener('click', function() {
                    const filterType = this.hasAttribute('data-snow') ? 'snow' : 'gun-laws';
                    const selector = filterType === 'snow' ? '.pillbox[data-snow]' : '.pillbox[data-gun-laws]';

                    if (this.classList.contains('active')) {
                        this.classList.remove('active');
                        refreshResults();
                    } else {
                        // Only remove active from same filter type
                        document.querySelectorAll(selector).forEach(p => p.classList.remove('active'));
                        this.classList.add('active');
                        refreshResults();
                    }
                });
            });

            // Handle LGBTQ checkbox change
            if (lgbtqCheckbox) {
                lgbtqCheckbox.addEventListener('change', function() {
                    refreshResults();
                });
            }

            // Handle sort changes (preserve current filters)
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    refreshResults();
                });
            }
        });
    </script>
</body>
</html>
